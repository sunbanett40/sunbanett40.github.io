<!DOCTYPE html>
<html lang="en-UK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Butty Builds</title>


  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->

<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">


<link rel="stylesheet" href="/css/style.css">

</head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/sidebar.png)">
        <div class='av-pic' style="background-image: url(/assets/profile1.jpg)">
        </div>
    </section>
    <section class='menu'>
        <div>Butty Builds</div>

        <ul>

            <a href="/" class="Btn">
              <li>Home</li>
            </a>  

            <a href="/about/" class="Btn">
              <li>About</li>
            </a>  

            <a href="/logbooks/" class="Btn">
              <li>Logbooks</li>
            </a>  

            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  

        </ul>
    </section>
    <section class="media">


                <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/joseph-butterworth-6a587b207/">
                    <img src="/assets/linkedin.svg" />
                </a>



                <a target="_blank" rel="noopener" href="https://github.com/sunbanett40">
                    <img src="/assets/github.svg" />
                </a>



                <a target="_blank" rel="noopener" href="https://www.thingiverse.com/sunbane/designs">
                    <img src="/assets/thingiverse.svg" />
                </a>


    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <ul class="Index">

    <header class='PageTitle'>
        <h1>{ Assembler }</h1>
    </header>


    <li>
      <article class='ListView'>
    <header class="title">

        <h1>
          <a href="/2021/01/26/SystemVerilog-Microprocessor-Part-2-XOR-decryption/">SystemVerilog Microprocessor Part 2 - XOR decryption</a>
        </h1>

      <div class='ListMeta'>
  <time datetime="2021-01-26T20:38:43.000Z" itemprop="datePublished">
    2021-01-26
  </time>

  | 
  <ul>

  <li class="meta-text">
  { <a href="/tags/Microcontroller/">Microcontroller</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Assembler/">Assembler</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/SystemVerilog-HDL/">SystemVerilog HDL</a> }
  </li>


  </ul>


</div>

    </header>
    <div>

        <h3 id="Encryption-and-Decryption"><a href="#Encryption-and-Decryption" class="headerlink" title="Encryption and Decryption"></a>Encryption and Decryption</h3><p>To decrypt a XOR encrypted message the decryption is to XOR the encrypted message with the  key again.</p>
<p>As the key is unknown to us and the number of possible keys (32) is small it is easy to brute force the solution by testing every possible key.</p>
<p>To test the output when the string “oiytmmvk” is decrypted with every possible key I wrote a program in ROM that would load in each value from the switches into a position in the RAM. It would then XOR each of these with a key outputting it to the display. Finally it would increment the key by one and repeat. This program meant I also had to modify the testbench so that it<br>would input the value wanted.</p>
<p>As the length of my program was now longer than even the 32 total addresses in the 8 bit system, I had to increase the system size to a ten bit system. This provided me with 128 total addresses for my program to be stored.</p>
<p>Updating to 10 bit from 8 bit meant that I had increase the word width so that the system could target each address. I did this by changing the parameter in each file. I also moved the addresses of the the tri-state buffer and the display registers, to positions 126 and 127, so that they weren’t taking ROM slots part way through the program.</p>
<p>I found that I did not need the subtract operation or the complement operation (that I implemented). However, as the total number of operations was still five, requiring 3 bits to encode them still, I did not see the value in removing them from my design.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">case</span> (mar)</span><br><span class="line"> <span class="number">0</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">1</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d64 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">2</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d65 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">5</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d66 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">6</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">7</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d67 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">8</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">9</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d68 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">10</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">11</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d69 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">12</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">13</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d70 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">14</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">15</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d71 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">16</span>: mdr = &#123;<span class="meta">`BNE, 7&#x27;d52 &#125;;</span></span><br><span class="line"> <span class="number">22</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d64 &#125;; //Load the character 1 into the accumulator</span></span><br><span class="line"> <span class="number">23</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">24</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">25</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d65 &#125;; //Load the character 2 into the accumulator</span></span><br><span class="line"> <span class="number">26</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">27</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">28</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d66 &#125;; //Load the character 3 into the accumulator</span></span><br><span class="line"> <span class="number">29</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">30</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">31</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d67 &#125;; //Load the character 4 into the accumulator</span></span><br><span class="line"> <span class="number">32</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key </span></span><br><span class="line"> <span class="number">33</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">34</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d68 &#125;; //Load the character 5 into the accumulator</span></span><br><span class="line"> <span class="number">35</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">36</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">37</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d69 &#125;; //Load the character 6 into the accumulator</span></span><br><span class="line"> <span class="number">38</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">39</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">40</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d70 &#125;; //Load the character 7 into the accumulator</span></span><br><span class="line"> <span class="number">41</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">42</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">43</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d71 &#125;; //Load the character 8 into the accumulator</span></span><br><span class="line"> <span class="number">44</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">45</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">46</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d80 &#125;; //Load key</span></span><br><span class="line"> <span class="number">47</span>: mdr = &#123;<span class="meta">`ADD, 7&#x27;d53 &#125;; //Add 1</span></span><br><span class="line"> <span class="number">48</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d80 &#125;; //Store key</span></span><br><span class="line"> <span class="number">49</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d54 &#125;;</span></span><br><span class="line"> <span class="number">50</span>: mdr = &#123;<span class="meta">`BNE, 7&#x27;d55 &#125;; //Loop until all keys are tried</span></span><br><span class="line"> <span class="number">52</span>: mdr = <span class="number">22</span>;</span><br><span class="line"> <span class="number">53</span>: mdr = <span class="number">1</span>;</span><br><span class="line"> <span class="number">54</span>: mdr = <span class="number">8</span>;</span><br><span class="line"> <span class="number">55</span>: mdr = <span class="number">16</span>;</span><br><span class="line"> <span class="comment">/*RAM:</span></span><br><span class="line"><span class="comment">64: encrypted character 1</span></span><br><span class="line"><span class="comment">65: encrypted character 2</span></span><br><span class="line"><span class="comment">66: encrypted character 3</span></span><br><span class="line"><span class="comment">67: encrypted character 4</span></span><br><span class="line"><span class="comment">68: encrypted character 5</span></span><br><span class="line"><span class="comment">69: encrypted character 6</span></span><br><span class="line"><span class="comment">70: encrypted character 7</span></span><br><span class="line"><span class="comment">71: encrypted character 8</span></span><br><span class="line"><span class="comment">80: key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> <span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"> <span class="keyword">endcase</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>This is the start of the program in modelSIM as the value on the switches is loaded in. Brute forcing through all 32 combinations gives the solutions:<br><img src="/images/sv-microprocessor/waveform5.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">NHXULLWJ</span><br><span class="line">MK[VOOTI</span><br><span class="line">LJZWNNUH</span><br><span class="line">KM]PIIRO</span><br><span class="line">JL&#x2F;QHHSN</span><br><span class="line">IO RKKPM</span><br><span class="line">HN.SJJQL</span><br><span class="line">GAQ&#x2F;EE.C</span><br><span class="line">F@P]DD B</span><br><span class="line">ECS.GG&#x2F;A</span><br><span class="line">DBR FF]@</span><br><span class="line">CEUXAAZG</span><br><span class="line">BDTY@@[F</span><br><span class="line">AGWZCCXE</span><br><span class="line">@FV[BBYD</span><br><span class="line">YID]]F[ </span><br><span class="line">.XHE&#x2F;&#x2F;GZ</span><br><span class="line">][KF DY </span><br><span class="line">&#x2F;ZJG..EX</span><br><span class="line">[]M@YYB </span><br><span class="line">Z&#x2F;LAXXC.</span><br><span class="line">Y OB[[@]</span><br><span class="line">X.NCZZA\</span><br><span class="line">WQALUUNS</span><br><span class="line">VP@MTTOR</span><br><span class="line">USCNWWLQ</span><br><span class="line">TRBOVVMP</span><br><span class="line">SUEHQQJW</span><br><span class="line">RTDIPPKV</span><br><span class="line">QWGJSSHU</span><br><span class="line">PVFKRRIT</span><br><span class="line">OIYTMMVK</span><br></pre></td></tr></table></figure>

<p>The tenth key is a link to the ecs intranet and provides the webpage below:<br><img src="/images/sv-microprocessor/message.png" alt="ECS Intranet page" style="width: 100%; height: 100%"></p>
<h3 id="Encryption-and-Decryption-with-loops"><a href="#Encryption-and-Decryption-with-loops" class="headerlink" title="Encryption and Decryption with loops"></a>Encryption and Decryption with loops</h3><p>Before my invigilator made it clear that a brute force attack was sufficient. I began to try and make a program that could operate loops in such a way that it could change the target address. It would do this by loading a “function” into memory it could then update the address by<br>overwriting later lines with commands dependent on the outcome from the operation.</p>
<p>This method required the entire program to be written in ROM and the space for the largest function and the auto loader to be in the RAM. This meant that this design still required moreaddress than the eight bits would allow.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//auto Loader</span></span><br><span class="line"><span class="number">90</span>: mdr = &#123;<span class="meta">`LOAD, (`LOAD position_rom_start)&#125;;</span></span><br><span class="line"><span class="number">91</span>: mdr = &#123;<span class="meta">`ADD, load_position&#125;;</span></span><br><span class="line"><span class="number">92</span>: mdr = &#123;<span class="meta">`STORE, 96&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">93</span>: mdr = &#123;<span class="meta">`LOAD, (`STORE position_ram_start)&#125;;</span></span><br><span class="line"><span class="number">94</span>: mdr = &#123;<span class="meta">`ADD, position_load&#125;;</span></span><br><span class="line"><span class="number">95</span>: mdr = &#123;<span class="meta">`STORE, 97&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">96</span>: mdr = &#123;<span class="meta">`LOAD, program_in&#125;;</span></span><br><span class="line"><span class="number">97</span>: mdr = &#123;<span class="meta">`STORE, program_out&#125;;</span></span><br><span class="line"><span class="number">98</span>: mdr = &#123;<span class="meta">`BNE, 90&#125;;</span></span><br><span class="line"><span class="comment">//input</span></span><br><span class="line"><span class="number">100</span>: mdr = &#123;<span class="meta">`LOAD, switches&#125;;</span></span><br><span class="line"><span class="number">101</span>: mdr = &#123;<span class="meta">`STORE, ACC_TEMP&#125;;</span></span><br><span class="line"><span class="number">102</span>: mdr = &#123;<span class="meta">`LOAD, (`STORE position_character_start)&#125;;</span></span><br><span class="line"><span class="number">103</span>: mdr = &#123;<span class="meta">`ADD, character_position&#125;;</span></span><br><span class="line"><span class="number">104</span>: mdr = &#123;<span class="meta">`STORE, 106&#125;;</span></span><br><span class="line"><span class="number">105</span>: mdr = &#123;<span class="meta">`LOAD, ACC_TEMP&#125;;</span></span><br><span class="line"><span class="number">106</span>: mdr = &#123;<span class="meta">`STORE, position&#125;;</span></span><br><span class="line"><span class="number">107</span>: mdr = &#123;<span class="meta">`BNE, 100&#125;;</span></span><br><span class="line"><span class="comment">//encryption-decryption</span></span><br><span class="line"><span class="number">100</span>: mdr = &#123;<span class="meta">`LOAD, (`LOAD character_in_start)&#125;;</span></span><br><span class="line"><span class="number">101</span>: mdr = &#123;<span class="meta">`ADD, position&#125;;</span></span><br><span class="line"><span class="number">102</span>: mdr = &#123;<span class="meta">`STORE, 106&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">103</span>: mdr = &#123;<span class="meta">`LOAD, (`STORE character_out_start)&#125;;</span></span><br><span class="line"><span class="number">104</span>: mdr = &#123;<span class="meta">`ADD, position&#125;;</span></span><br><span class="line"><span class="number">105</span>: mdr = &#123;<span class="meta">`STORE, 108&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">106</span>: mdr = &#123;<span class="meta">`LOAD, character_in&#125;;</span></span><br><span class="line"><span class="number">107</span>: mdr = &#123;<span class="meta">`XOR, key&#125;;</span></span><br><span class="line"><span class="number">108</span>: mdr = &#123;<span class="meta">`STORE, character_out&#125;;</span></span><br><span class="line"><span class="number">109</span>: mdr = &#123;<span class="meta">`STORE, Display&#125;;</span></span><br><span class="line"><span class="number">110</span>: mdr = &#123;<span class="meta">`LOAD, position&#125;;</span></span><br><span class="line"><span class="number">111</span>: mdr = &#123;<span class="meta">`ADD, 1&#125;;</span></span><br><span class="line"><span class="number">112</span>: mdr = &#123;<span class="meta">`STORE, position&#125;;</span></span><br><span class="line"><span class="number">113</span>: mdr = &#123;<span class="meta">`XOR, length&#125;;</span></span><br><span class="line"><span class="number">114</span>: mdr = &#123;<span class="meta">`BNE, 100&#125;;</span></span><br><span class="line"><span class="number">115</span>: mdr = &#123;<span class="meta">`LOAD, key&#125;;</span></span><br><span class="line"><span class="number">116</span>: mdr = &#123;<span class="meta">`ADD, 1&#125;;</span></span><br><span class="line"><span class="number">117</span>: mdr = &#123;<span class="meta">`STORE, key&#125;;</span></span><br><span class="line"><span class="number">118</span>: mdr = &#123;<span class="meta">`XOR, possible_keys&#125;;</span></span><br><span class="line"><span class="number">119</span>: mdr = &#123;<span class="meta">`BNE, 100&#125;;</span></span><br></pre></td></tr></table></figure>

<p>I abandoned this method upon understanding that brute force was sufficient. By this point, I had written in pseudo code an auto-loader to load the program. A function to load the inputs and the brute force method with a loop to target different addresses.</p>
<h3 id="XOR-Then-XNOR-Encryption"><a href="#XOR-Then-XNOR-Encryption" class="headerlink" title="XOR Then XNOR Encryption"></a>XOR Then XNOR Encryption</h3><p>I changed the complement into a XNOR function. The XNOR function will add further complexity to the encryption as it adds a second key on top of the existing function.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always_ff</span> @( <span class="keyword">posedge</span> clock, <span class="keyword">negedge</span> n_reset)</span><br><span class="line"> <span class="keyword">begin</span></span><br><span class="line"> <span class="keyword">if</span> (!n_reset)</span><br><span class="line"> acc &lt;= <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> <span class="keyword">if</span> (load_ACC)</span><br><span class="line"> <span class="keyword">if</span> (ALU_ACC)</span><br><span class="line"> <span class="keyword">begin</span></span><br><span class="line"> <span class="keyword">if</span> (ALU_add)</span><br><span class="line"> acc &lt;= acc + sysbus;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_sub)</span><br><span class="line"> acc &lt;= acc - sysbus;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_xor)</span><br><span class="line"> acc &lt;= acc ^ sysbus;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_xnor)</span><br><span class="line"> acc &lt;= ~(acc ^ sysbus);</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> acc &lt;= sysbus;</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>To decrypt this some one will have to know both keys and the order they were applied in. This increases the number of possible sets of keys to 2048. This is still manageable to brute force but will take orders of magnitude longer.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> (mar)</span><br><span class="line"><span class="number">0</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">1</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d64 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">2</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d65 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">5</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d66 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">6</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">7</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d67 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">8</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">9</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d68 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">10</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">11</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d69 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">12</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">13</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d70 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">14</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">15</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d71 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">16</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d64 &#125;; //Load the character 1 into the accumulator</span></span><br><span class="line"><span class="number">17</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">18</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">19</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">20</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d65 &#125;; //Load the character 2 into the accumulator</span></span><br><span class="line"><span class="number">21</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">22</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">23</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">24</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d66 &#125;; //Load the character 3 into the accumulator</span></span><br><span class="line"><span class="number">25</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">26</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key </span></span><br><span class="line"><span class="number">27</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">28</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d67 &#125;; //Load the character 4 into the accumulator</span></span><br><span class="line"><span class="number">29</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">30</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">31</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">32</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d68 &#125;; //Load the character 5 into the accumulator</span></span><br><span class="line"><span class="number">33</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">34</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">35</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">36</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d69 &#125;; //Load the character 6 into the accumulator</span></span><br><span class="line"><span class="number">37</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">38</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">39</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">40</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d70 &#125;; //Load the character 7 into the accumulator</span></span><br><span class="line"><span class="number">41</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">42</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">43</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">44</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d71 &#125;; //Load the character 8 into the accumulator</span></span><br><span class="line"><span class="number">45</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">46</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">47</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">51</span>: mdr = <span class="number">21</span>; <span class="comment">//XOR Key</span></span><br><span class="line"><span class="number">52</span>: mdr = <span class="number">10</span>; <span class="comment">//XNOR key</span></span><br><span class="line"><span class="number">53</span>: mdr = <span class="number">1</span>;</span><br><span class="line"><span class="number">54</span>: mdr = <span class="number">8</span>;</span><br><span class="line"><span class="number">55</span>: mdr = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"><span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span> </span><br></pre></td></tr></table></figure>

<h3 id="XOR-With-Multiple-Keys-Encryption"><a href="#XOR-With-Multiple-Keys-Encryption" class="headerlink" title="XOR With Multiple Keys Encryption"></a>XOR With Multiple Keys Encryption</h3><p>Finally I implemented a new program that would encrypt or decrypt the message using a key of multiple bytes. This program would read in both the string and a key, of length 3.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">case</span> (mar)</span><br><span class="line"> <span class="number">0</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">1</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d64 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">2</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d65 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">5</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d66 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">6</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">7</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d67 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">8</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">9</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d68 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">10</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">11</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d69 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">12</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">13</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d70 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">14</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">15</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d71 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">16</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator </span></span><br><span class="line"> <span class="number">17</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d72 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">18</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">19</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d73 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">20</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">21</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d74 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">22</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d64 &#125;; //Load the character 1 into the accumulator</span></span><br><span class="line"> <span class="number">23</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d72 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">24</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">25</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d65 &#125;; //Load the character 2 into the accumulator</span></span><br><span class="line"> <span class="number">26</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d73 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">27</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">28</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d66 &#125;; //Load the character 3 into the accumulator</span></span><br><span class="line"> <span class="number">29</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d74 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">30</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">31</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d67 &#125;; //Load the character 4 into the accumulator</span></span><br><span class="line"> <span class="number">32</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d72 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">33</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">34</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d68 &#125;; //Load the character 5 into the accumulator</span></span><br><span class="line"> <span class="number">35</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d73 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">36</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">37</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d69 &#125;; //Load the character 6 into the accumulator</span></span><br><span class="line"> <span class="number">38</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d74 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">39</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">40</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d70 &#125;; //Load the character 7 into the accumulator</span></span><br><span class="line"> <span class="number">41</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d72 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">42</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">43</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d71 &#125;; //Load the character 8 into the accumulator</span></span><br><span class="line"> <span class="number">44</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d73 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">45</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">46</span>: mdr = &#123;<span class="meta">`BNE, 7&#x27;d55 &#125;; //Loop until all keys are tried</span></span><br><span class="line"> <span class="number">53</span>: mdr = <span class="number">1</span>;</span><br><span class="line"> <span class="number">54</span>: mdr = <span class="number">8</span>;</span><br><span class="line"> <span class="number">55</span>: mdr = <span class="number">22</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*RAM:</span></span><br><span class="line"><span class="comment">64: encrypted character 1</span></span><br><span class="line"><span class="comment">65: encrypted character 2</span></span><br><span class="line"><span class="comment">66: encrypted character 3</span></span><br><span class="line"><span class="comment">67: encrypted character 4</span></span><br><span class="line"><span class="comment">68: encrypted character 5</span></span><br><span class="line"><span class="comment">69: encrypted character 6</span></span><br><span class="line"><span class="comment">70: encrypted character 7</span></span><br><span class="line"><span class="comment">71: encrypted character 8</span></span><br><span class="line"><span class="comment">72: key 1</span></span><br><span class="line"><span class="comment">73: key 2</span></span><br><span class="line"><span class="comment">74: key 3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"> <span class="keyword">endcase</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>To brute force a key length of three it would have to try 32768 possible combinations of keys. However, if the length of the key is unknown it becomes exponentially harder to brute force the attack.</p>
<p>This method is scalable with different key lengths but can still be decrypted as long as the length of the key is less than the length of the encrypted string.</p>
<h4 id="Github-Repository-https-github-com-sunbanett40-XOR-Decryptor"><a href="#Github-Repository-https-github-com-sunbanett40-XOR-Decryptor" class="headerlink" title="Github Repository: https://github.com/sunbanett40/XOR-Decryptor"></a>Github Repository: <a target="_blank" rel="noopener" href="https://github.com/sunbanett40/XOR-Decryptor">https://github.com/sunbanett40/XOR-Decryptor</a></h4>

    </div>
</article>

    </li>

    <li>
      <article class='ListView'>
    <header class="title">

        <h1>
          <a href="/2021/01/24/SystemVerilog-Microprocessor-Part-1-Building-the-Microprocessor/">SystemVerilog Microprocessor Part 1 - Building the Microprocessor</a>
        </h1>

      <div class='ListMeta'>
  <time datetime="2021-01-24T15:02:00.000Z" itemprop="datePublished">
    2021-01-24
  </time>

  | 
  <ul>

  <li class="meta-text">
  { <a href="/tags/Microcontroller/">Microcontroller</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Assembler/">Assembler</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/State-Machines/">State Machines</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/SystemVerilog-HDL/">SystemVerilog HDL</a> }
  </li>


  </ul>


</div>

    </header>
    <div>

        <h3 id="Microprocessor-Architecture"><a href="#Microprocessor-Architecture" class="headerlink" title="Microprocessor Architecture"></a>Microprocessor Architecture</h3><p style="text-align:center;"><img src="/images/sv-microprocessor/IMG_20210123_152930.jpg" alt="CPU Architecture" style="width: 50%; height: 50%">

</p><p>PC:<br>The program counter is a sequential logic module that records the position of the program through the ROM and outputs the position to the sysbus when the next instruction needs to be loaded.</p>
<p>IR:<br>The instruction register is a sequential logic module that reads the opcode from the sysbus and passes it to the sequencer.</p>
<p>Sequencer:<br>The sequencer is a state machine that controls the order of operation for the other modules. This is important to stop any bus contention occurring.</p>
<p style="text-align:center;"><img src="/images/sv-microprocessor/IMG_20210123_151328.jpg" alt="Sequencer ASM Chart" style="width: 50%; height: 50%">

</p><h3 id="Memory-Mapped-Input-and-Output"><a href="#Memory-Mapped-Input-and-Output" class="headerlink" title="Memory Mapped Input and Output"></a>Memory Mapped Input and Output</h3><p>A buffer and a register were now instantiated so that these could be used as input and output to the Microcontroller</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//instantiate 1 register and 1 buffer here</span></span><br><span class="line">buffer <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) b1 (.*)</span>;</span><br><span class="line">sequencer <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) s1 (.*)</span>;</span><br><span class="line">ir <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) i1 (.*)</span>;</span><br><span class="line">pc <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) p1 (.*)</span>;</span><br><span class="line">alu <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) a1 (.*)</span>;</span><br><span class="line">ram <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) r1 (.*)</span>;</span><br><span class="line">rom <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) r2 (.*)</span>;</span><br><span class="line">register <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) r3 (.*)</span>;</span><br></pre></td></tr></table></figure>

<p>The memory, going from address 0 to address 31, should now be connected to these applications.</p>
<p style="text-align:center;"><img src="/images/sv-microprocessor/Memory.png" alt="Memory addresses" style="width: 50%; height: 50%">

</p><p>However, if the CPU attempts to read from address 30, both the buffer and the RAM will be enabled. This is a problem as both RAM and the buffer will assert their values onto the sysbus as they are both being read. The two values on the same bus will interfere with each other giving a signal that is likely neither of them. This is bus contention.</p>
<p>Modifying this line so that mdr is not written to the bus when mar contains addresses 30 or 31.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The following line in the ram module copies the contents of mdr to sysbus:</span></span><br><span class="line"><span class="keyword">assign</span> sysbus = (MDR_bus &amp; mar[WORD_W-OP_W-<span class="number">1</span>]</span><br><span class="line"> &amp; ~(mar==<span class="number">30</span> | mar==<span class="number">31</span>)) ? mdr : &#x27;z ; </span><br></pre></td></tr></table></figure>

<p>Modifying the testbench, I made switches and displays as variables</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> testcpu;</span><br><span class="line"><span class="keyword">parameter</span> <span class="keyword">int</span> WORD_W = <span class="number">8</span>, OP_W = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">logic</span> clock, n_reset;</span><br><span class="line"><span class="keyword">logic</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] switches;</span><br><span class="line"><span class="keyword">logic</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] display;</span><br><span class="line"><span class="keyword">wire</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] sysbus;</span><br></pre></td></tr></table></figure>

<p>Simulating my testbench and microprocessor in Modelsim I got this output for my variables.<br><img src="/images/sv-microprocessor/waveform1.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<p>Both the display register and the switches are of unknown value as they are not defined at any point in the testbench or the program.</p>
<p>I modified the program in the rom module such that the result in the accumulator is STOREd to address 31 (display) as well as address 16.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cpu2 <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) c1 (.*)</span>;</span><br><span class="line"> <span class="number">0</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">1</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">2</span>: mdr = &#123;<span class="meta">`ADD, 5&#x27;d6 &#125;; //Add the contents of address to the accumulator</span></span><br><span class="line"> <span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">4</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d31 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">5</span>: mdr = &#123;<span class="meta">`BNE, 5&#x27;d7 &#125;; //Branch if result of last arithmetic operation is not zero</span></span><br><span class="line"> <span class="number">6</span>: mdr = <span class="number">2</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"> <span class="number">7</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br></pre></td></tr></table></figure>

<p>My modified program would output the value to the display register. This clearly shows the<br>program counts up in twos.</p>
<img src="/images/sv-microprocessor/waveform2.png" alt="Modelsim output" style="width: 100%; height: 100%">

<p>I then made a second change to the program in the rom module such that the data for the ADD operation comes from address 30 – the switches. In addition I also modified “testcpu” to apply different values to the switches during the simulation. </p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">1</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">2</span>: mdr = &#123;<span class="meta">`ADD, 5&#x27;d30 &#125;; //Add the contents of address to the accumulator</span></span><br><span class="line"><span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">4</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d31 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">5</span>: mdr = &#123;<span class="meta">`BNE, 5&#x27;d6 &#125;; //Branch if result of last arithmetic operation is not zero</span></span><br><span class="line"><span class="number">6</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br></pre></td></tr></table></figure>

<p>My new program would take the values from the switches and add it to the current value, outputting it to the display register.<br><img src="/images/sv-microprocessor/waveform3.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<h3 id="Extending-the-Microprocessor"><a href="#Extending-the-Microprocessor" class="headerlink" title="Extending the Microprocessor"></a>Extending the Microprocessor</h3><p>Creating a new version of the CPU, cpu3, I added the bitwise xor and bitwise not (complement) functions to act on the accumulator. This meant defining the opcodes, adding new enable lines between the ALU and sequencer, adding the functionality to the ALU and Sequencer and writing a new program in ROM to use these commands.</p>
<p>ALU: </p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (load_ACC)</span><br><span class="line"><span class="keyword">if</span> (ALU_ACC)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span> (ALU_add)</span><br><span class="line">acc &lt;= acc + sysbus;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ALU_sub)</span><br><span class="line">acc &lt;= acc - sysbus;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ALU_xor)</span><br><span class="line">acc &lt;= acc ^ sysbus;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ALU_comp)</span><br><span class="line">acc &lt;= ~acc;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Sequencer:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">acc &lt;= sysbus;</span><br><span class="line">s8: <span class="keyword">begin</span></span><br><span class="line">MDR_bus = <span class="number">1&#x27;b1</span> ;</span><br><span class="line">ALU_ACC = <span class="number">1&#x27;b1</span> ;</span><br><span class="line">load_ACC = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">if</span> (op == <span class="meta">`ADD)</span></span><br><span class="line">ALU_add = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="meta">`SUB)</span></span><br><span class="line">ALU_sub = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="meta">`XOR)</span></span><br><span class="line">ALU_xor = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="meta">`COMP)</span></span><br><span class="line">ALU_comp = <span class="number">1&#x27;b1</span> ;</span><br><span class="line">Next_State = s0;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>CPU:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> cpu1 <span class="variable">#( parameter WORD_W = 8, OP_W = 3)</span></span><br><span class="line"> ( <span class="keyword">input</span> <span class="keyword">logic</span> clock, n_reset,</span><br><span class="line"> <span class="keyword">inout</span> <span class="keyword">wire</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] sysbus);</span><br><span class="line"><span class="keyword">logic</span> ACC_bus, load_ACC, PC_bus, load_PC, load_IR, load_MAR,</span><br><span class="line">MDR_bus, load_MDR, ALU_ACC, ALU_add, ALU_sub, ALU_xor, ALU_comp,</span><br><span class="line">INC_PC, Addr_bus, CS, R_NW, z_flag; </span><br></pre></td></tr></table></figure>

<p>ROM:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> (mar)</span><br><span class="line"><span class="number">0</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">1</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">2</span>: mdr = &#123;<span class="meta">`COMP, 5&#x27;d8 &#125;; //Complement the contents of the accumulator</span></span><br><span class="line"><span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">5</span>: mdr = &#123;<span class="meta">`XOR, 5&#x27;d9 &#125;; //Xor the contents of address with the accumulator</span></span><br><span class="line"><span class="number">6</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">7</span>: mdr = &#123;<span class="meta">`BNE, 5&#x27;d10 &#125;; //Branch if result of last arithmetic operation is not zero</span></span><br><span class="line"><span class="number">8</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"><span class="number">9</span>: mdr = <span class="number">170</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"><span class="number">10</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"><span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"><span class="keyword">endcase</span></span><br></pre></td></tr></table></figure>

<p>I then verified that the program was working correctly by simulating it in modelsim and going through each operation. I found that by the end of the first cycle the value in ram was 1’h55, which was to be expected when 1’hFF and 1’hAA are XORed together.<br><img src="/images/sv-microprocessor/waveform4.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<h4 id="Github-Repository-https-github-com-sunbanett40-XOR-Decryptor"><a href="#Github-Repository-https-github-com-sunbanett40-XOR-Decryptor" class="headerlink" title="Github Repository: https://github.com/sunbanett40/XOR-Decryptor"></a>Github Repository: <a target="_blank" rel="noopener" href="https://github.com/sunbanett40/XOR-Decryptor">https://github.com/sunbanett40/XOR-Decryptor</a></h4>

    </div>
</article>

    </li>

    <li>
      <article class='ListView'>
    <header class="title">

        <h1>
          <a href="/2019/06/13/Lottery-Number-Generator-PIC16F88/">Lottery Number Generator - PIC16F88</a>
        </h1>

      <div class='ListMeta'>
  <time datetime="2019-06-13T01:07:00.000Z" itemprop="datePublished">
    2019-06-13
  </time>

  | 
  <ul>

  <li class="meta-text">
  { <a href="/tags/Electronics/">Electronics</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Microcontroller/">Microcontroller</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Assembler/">Assembler</a> }
  </li>


  </ul>


</div>

    </header>
    <div>

        <p>Unfortunately content is missing :(</p>


    </div>
</article>

    </li>

</ul>



            <footer>
    <div>© 2021 - Joseph Butterworth </div>
    <div>
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a target="_blank" rel="noopener" href="https://github.com/nameoverflow/hexo-theme-icalm">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>