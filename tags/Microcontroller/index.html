<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Butty Builds</title>
  
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">

  
<link rel="stylesheet" href="/css/style.css">

</head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/header.jpg)">
        <div class='av-pic' style="background-image: url(/assets/gremlin.jpg)">
        </div>
    </section>
    <section class='menu'>
        <div>Butty Builds</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/logbooks/" class="Btn">
              <li>Logbooks</li>
            </a>  
          
            <a href="/about/" class="Btn">
              <li>About</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <ul class="Index">
  
    <header class='PageTitle'>
        <h1>{ Microcontroller }</h1>
    </header>
  
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2021/01/26/SystemVerilog-Microprocessor-Part-2-XOR-decryption/">SystemVerilog Microprocessor Part 2 - XOR decryption</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2021-01-26T20:38:43.000Z" itemprop="datePublished">
    2021-01-26
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/Microcontroller/">Microcontroller</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Assembler/">Assembler</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/SystemVerilog-HDL/">SystemVerilog HDL</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <h3 id="Encryption-and-Decryption"><a href="#Encryption-and-Decryption" class="headerlink" title="Encryption and Decryption"></a>Encryption and Decryption</h3><p>To decrypt a XOR encrypted message the decryption is to XOR the encrypted message with the  key again.</p>
<p>As the key is unknown to us and the number of possible keys (32) is small it is easy to brute force the solution by testing every possible key.</p>
<p>To test the output when the string “oiytmmvk” is decrypted with every possible key I wrote a program in ROM that would load in each value from the switches into a position in the RAM. It would then XOR each of these with a key outputting it to the display. Finally it would increment the key by one and repeat. This program meant I also had to modify the testbench so that it<br>would input the value wanted.</p>
<p>As the length of my program was now longer than even the 32 total addresses in the 8 bit system, I had to increase the system size to a ten bit system. This provided me with 128 total addresses for my program to be stored.</p>
<p>Updating to 10 bit from 8 bit meant that I had increase the word width so that the system could target each address. I did this by changing the parameter in each file. I also moved the addresses of the the tri-state buffer and the display registers, to positions 126 and 127, so that they weren’t taking ROM slots part way through the program.</p>
<p>I found that I did not need the subtract operation or the complement operation (that I implemented). However, as the total number of operations was still five, requiring 3 bits to encode them still, I did not see the value in removing them from my design.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">case</span> (mar)</span><br><span class="line"> <span class="number">0</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">1</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d64 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">2</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d65 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">5</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d66 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">6</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">7</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d67 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">8</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">9</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d68 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">10</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">11</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d69 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">12</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">13</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d70 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">14</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">15</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d71 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">16</span>: mdr = &#123;<span class="meta">`BNE, 7&#x27;d52 &#125;;</span></span><br><span class="line"> <span class="number">22</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d64 &#125;; //Load the character 1 into the accumulator</span></span><br><span class="line"> <span class="number">23</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">24</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">25</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d65 &#125;; //Load the character 2 into the accumulator</span></span><br><span class="line"> <span class="number">26</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">27</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">28</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d66 &#125;; //Load the character 3 into the accumulator</span></span><br><span class="line"> <span class="number">29</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">30</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">31</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d67 &#125;; //Load the character 4 into the accumulator</span></span><br><span class="line"> <span class="number">32</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key </span></span><br><span class="line"> <span class="number">33</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">34</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d68 &#125;; //Load the character 5 into the accumulator</span></span><br><span class="line"> <span class="number">35</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">36</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">37</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d69 &#125;; //Load the character 6 into the accumulator</span></span><br><span class="line"> <span class="number">38</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">39</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">40</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d70 &#125;; //Load the character 7 into the accumulator</span></span><br><span class="line"> <span class="number">41</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">42</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">43</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d71 &#125;; //Load the character 8 into the accumulator</span></span><br><span class="line"> <span class="number">44</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d80 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">45</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">46</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d80 &#125;; //Load key</span></span><br><span class="line"> <span class="number">47</span>: mdr = &#123;<span class="meta">`ADD, 7&#x27;d53 &#125;; //Add 1</span></span><br><span class="line"> <span class="number">48</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d80 &#125;; //Store key</span></span><br><span class="line"> <span class="number">49</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d54 &#125;;</span></span><br><span class="line"> <span class="number">50</span>: mdr = &#123;<span class="meta">`BNE, 7&#x27;d55 &#125;; //Loop until all keys are tried</span></span><br><span class="line"> <span class="number">52</span>: mdr = <span class="number">22</span>;</span><br><span class="line"> <span class="number">53</span>: mdr = <span class="number">1</span>;</span><br><span class="line"> <span class="number">54</span>: mdr = <span class="number">8</span>;</span><br><span class="line"> <span class="number">55</span>: mdr = <span class="number">16</span>;</span><br><span class="line"> <span class="comment">/*RAM:</span></span><br><span class="line"><span class="comment">64: encrypted character 1</span></span><br><span class="line"><span class="comment">65: encrypted character 2</span></span><br><span class="line"><span class="comment">66: encrypted character 3</span></span><br><span class="line"><span class="comment">67: encrypted character 4</span></span><br><span class="line"><span class="comment">68: encrypted character 5</span></span><br><span class="line"><span class="comment">69: encrypted character 6</span></span><br><span class="line"><span class="comment">70: encrypted character 7</span></span><br><span class="line"><span class="comment">71: encrypted character 8</span></span><br><span class="line"><span class="comment">80: key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> <span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"> <span class="keyword">endcase</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>This is the start of the program in modelSIM as the value on the switches is loaded in. Brute forcing through all 32 combinations gives the solutions:<br><img src="/images/sv-microprocessor/waveform5.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">NHXULLWJ</span><br><span class="line">MK[VOOTI</span><br><span class="line">LJZWNNUH</span><br><span class="line">KM]PIIRO</span><br><span class="line">JL&#x2F;QHHSN</span><br><span class="line">IO RKKPM</span><br><span class="line">HN.SJJQL</span><br><span class="line">GAQ&#x2F;EE.C</span><br><span class="line">F@P]DD B</span><br><span class="line">ECS.GG&#x2F;A</span><br><span class="line">DBR FF]@</span><br><span class="line">CEUXAAZG</span><br><span class="line">BDTY@@[F</span><br><span class="line">AGWZCCXE</span><br><span class="line">@FV[BBYD</span><br><span class="line">YID]]F[ </span><br><span class="line">.XHE&#x2F;&#x2F;GZ</span><br><span class="line">][KF DY </span><br><span class="line">&#x2F;ZJG..EX</span><br><span class="line">[]M@YYB </span><br><span class="line">Z&#x2F;LAXXC.</span><br><span class="line">Y OB[[@]</span><br><span class="line">X.NCZZA\</span><br><span class="line">WQALUUNS</span><br><span class="line">VP@MTTOR</span><br><span class="line">USCNWWLQ</span><br><span class="line">TRBOVVMP</span><br><span class="line">SUEHQQJW</span><br><span class="line">RTDIPPKV</span><br><span class="line">QWGJSSHU</span><br><span class="line">PVFKRRIT</span><br><span class="line">OIYTMMVK</span><br></pre></td></tr></table></figure>

<p>The tenth key is a link to the ecs intranet and provides the webpage below:<br><img src="/images/sv-microprocessor/message.png" alt="ECS Intranet page" style="width: 100%; height: 100%"></p>
<h3 id="Encryption-and-Decryption-with-loops"><a href="#Encryption-and-Decryption-with-loops" class="headerlink" title="Encryption and Decryption with loops"></a>Encryption and Decryption with loops</h3><p>Before my invigilator made it clear that a brute force attack was sufficient. I began to try and make a program that could operate loops in such a way that it could change the target address. It would do this by loading a “function” into memory it could then update the address by<br>overwriting later lines with commands dependent on the outcome from the operation.</p>
<p>This method required the entire program to be written in ROM and the space for the largest function and the auto loader to be in the RAM. This meant that this design still required moreaddress than the eight bits would allow.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//auto Loader</span></span><br><span class="line"><span class="number">90</span>: mdr = &#123;<span class="meta">`LOAD, (`LOAD position_rom_start)&#125;;</span></span><br><span class="line"><span class="number">91</span>: mdr = &#123;<span class="meta">`ADD, load_position&#125;;</span></span><br><span class="line"><span class="number">92</span>: mdr = &#123;<span class="meta">`STORE, 96&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">93</span>: mdr = &#123;<span class="meta">`LOAD, (`STORE position_ram_start)&#125;;</span></span><br><span class="line"><span class="number">94</span>: mdr = &#123;<span class="meta">`ADD, position_load&#125;;</span></span><br><span class="line"><span class="number">95</span>: mdr = &#123;<span class="meta">`STORE, 97&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">96</span>: mdr = &#123;<span class="meta">`LOAD, program_in&#125;;</span></span><br><span class="line"><span class="number">97</span>: mdr = &#123;<span class="meta">`STORE, program_out&#125;;</span></span><br><span class="line"><span class="number">98</span>: mdr = &#123;<span class="meta">`BNE, 90&#125;;</span></span><br><span class="line"><span class="comment">//input</span></span><br><span class="line"><span class="number">100</span>: mdr = &#123;<span class="meta">`LOAD, switches&#125;;</span></span><br><span class="line"><span class="number">101</span>: mdr = &#123;<span class="meta">`STORE, ACC_TEMP&#125;;</span></span><br><span class="line"><span class="number">102</span>: mdr = &#123;<span class="meta">`LOAD, (`STORE position_character_start)&#125;;</span></span><br><span class="line"><span class="number">103</span>: mdr = &#123;<span class="meta">`ADD, character_position&#125;;</span></span><br><span class="line"><span class="number">104</span>: mdr = &#123;<span class="meta">`STORE, 106&#125;;</span></span><br><span class="line"><span class="number">105</span>: mdr = &#123;<span class="meta">`LOAD, ACC_TEMP&#125;;</span></span><br><span class="line"><span class="number">106</span>: mdr = &#123;<span class="meta">`STORE, position&#125;;</span></span><br><span class="line"><span class="number">107</span>: mdr = &#123;<span class="meta">`BNE, 100&#125;;</span></span><br><span class="line"><span class="comment">//encryption-decryption</span></span><br><span class="line"><span class="number">100</span>: mdr = &#123;<span class="meta">`LOAD, (`LOAD character_in_start)&#125;;</span></span><br><span class="line"><span class="number">101</span>: mdr = &#123;<span class="meta">`ADD, position&#125;;</span></span><br><span class="line"><span class="number">102</span>: mdr = &#123;<span class="meta">`STORE, 106&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">103</span>: mdr = &#123;<span class="meta">`LOAD, (`STORE character_out_start)&#125;;</span></span><br><span class="line"><span class="number">104</span>: mdr = &#123;<span class="meta">`ADD, position&#125;;</span></span><br><span class="line"><span class="number">105</span>: mdr = &#123;<span class="meta">`STORE, 108&#125;; //update next <span class="meta-keyword">line</span></span></span><br><span class="line"><span class="number">106</span>: mdr = &#123;<span class="meta">`LOAD, character_in&#125;;</span></span><br><span class="line"><span class="number">107</span>: mdr = &#123;<span class="meta">`XOR, key&#125;;</span></span><br><span class="line"><span class="number">108</span>: mdr = &#123;<span class="meta">`STORE, character_out&#125;;</span></span><br><span class="line"><span class="number">109</span>: mdr = &#123;<span class="meta">`STORE, Display&#125;;</span></span><br><span class="line"><span class="number">110</span>: mdr = &#123;<span class="meta">`LOAD, position&#125;;</span></span><br><span class="line"><span class="number">111</span>: mdr = &#123;<span class="meta">`ADD, 1&#125;;</span></span><br><span class="line"><span class="number">112</span>: mdr = &#123;<span class="meta">`STORE, position&#125;;</span></span><br><span class="line"><span class="number">113</span>: mdr = &#123;<span class="meta">`XOR, length&#125;;</span></span><br><span class="line"><span class="number">114</span>: mdr = &#123;<span class="meta">`BNE, 100&#125;;</span></span><br><span class="line"><span class="number">115</span>: mdr = &#123;<span class="meta">`LOAD, key&#125;;</span></span><br><span class="line"><span class="number">116</span>: mdr = &#123;<span class="meta">`ADD, 1&#125;;</span></span><br><span class="line"><span class="number">117</span>: mdr = &#123;<span class="meta">`STORE, key&#125;;</span></span><br><span class="line"><span class="number">118</span>: mdr = &#123;<span class="meta">`XOR, possible_keys&#125;;</span></span><br><span class="line"><span class="number">119</span>: mdr = &#123;<span class="meta">`BNE, 100&#125;;</span></span><br></pre></td></tr></table></figure>

<p>I abandoned this method upon understanding that brute force was sufficient. By this point, I had written in pseudo code an auto-loader to load the program. A function to load the inputs and the brute force method with a loop to target different addresses.</p>
<h3 id="XOR-Then-XNOR-Encryption"><a href="#XOR-Then-XNOR-Encryption" class="headerlink" title="XOR Then XNOR Encryption"></a>XOR Then XNOR Encryption</h3><p>I changed the complement into a XNOR function. The XNOR function will add further complexity to the encryption as it adds a second key on top of the existing function.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always_ff</span> @( <span class="keyword">posedge</span> clock, <span class="keyword">negedge</span> n_reset)</span><br><span class="line"> <span class="keyword">begin</span></span><br><span class="line"> <span class="keyword">if</span> (!n_reset)</span><br><span class="line"> acc &lt;= <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> <span class="keyword">if</span> (load_ACC)</span><br><span class="line"> <span class="keyword">if</span> (ALU_ACC)</span><br><span class="line"> <span class="keyword">begin</span></span><br><span class="line"> <span class="keyword">if</span> (ALU_add)</span><br><span class="line"> acc &lt;= acc + sysbus;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_sub)</span><br><span class="line"> acc &lt;= acc - sysbus;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_xor)</span><br><span class="line"> acc &lt;= acc ^ sysbus;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> (ALU_xnor)</span><br><span class="line"> acc &lt;= ~(acc ^ sysbus);</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> acc &lt;= sysbus;</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>To decrypt this some one will have to know both keys and the order they were applied in. This increases the number of possible sets of keys to 2048. This is still manageable to brute force but will take orders of magnitude longer.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> (mar)</span><br><span class="line"><span class="number">0</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">1</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d64 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">2</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d65 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">5</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d66 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">6</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">7</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d67 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">8</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">9</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d68 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">10</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">11</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d69 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">12</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">13</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d70 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">14</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">15</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d71 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">16</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d64 &#125;; //Load the character 1 into the accumulator</span></span><br><span class="line"><span class="number">17</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">18</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">19</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">20</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d65 &#125;; //Load the character 2 into the accumulator</span></span><br><span class="line"><span class="number">21</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">22</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">23</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">24</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d66 &#125;; //Load the character 3 into the accumulator</span></span><br><span class="line"><span class="number">25</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">26</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key </span></span><br><span class="line"><span class="number">27</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">28</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d67 &#125;; //Load the character 4 into the accumulator</span></span><br><span class="line"><span class="number">29</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">30</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">31</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">32</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d68 &#125;; //Load the character 5 into the accumulator</span></span><br><span class="line"><span class="number">33</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">34</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">35</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">36</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d69 &#125;; //Load the character 6 into the accumulator</span></span><br><span class="line"><span class="number">37</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">38</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">39</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">40</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d70 &#125;; //Load the character 7 into the accumulator</span></span><br><span class="line"><span class="number">41</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">42</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">43</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">44</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d71 &#125;; //Load the character 8 into the accumulator</span></span><br><span class="line"><span class="number">45</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d51 &#125;; //XOR accumulator with XOR key</span></span><br><span class="line"><span class="number">46</span>: mdr = &#123;<span class="meta">`XNOR, 7&#x27;d52 &#125;; //XNOR accumulator with XNOR key</span></span><br><span class="line"><span class="number">47</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"><span class="number">51</span>: mdr = <span class="number">21</span>; <span class="comment">//XOR Key</span></span><br><span class="line"><span class="number">52</span>: mdr = <span class="number">10</span>; <span class="comment">//XNOR key</span></span><br><span class="line"><span class="number">53</span>: mdr = <span class="number">1</span>;</span><br><span class="line"><span class="number">54</span>: mdr = <span class="number">8</span>;</span><br><span class="line"><span class="number">55</span>: mdr = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"><span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span> </span><br></pre></td></tr></table></figure>

<h3 id="XOR-With-Multiple-Keys-Encryption"><a href="#XOR-With-Multiple-Keys-Encryption" class="headerlink" title="XOR With Multiple Keys Encryption"></a>XOR With Multiple Keys Encryption</h3><p>Finally I implemented a new program that would encrypt or decrypt the message using a key of multiple bytes. This program would read in both the string and a key, of length 3.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">case</span> (mar)</span><br><span class="line"> <span class="number">0</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">1</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d64 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">2</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d65 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">5</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d66 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">6</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">7</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d67 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">8</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">9</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d68 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">10</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">11</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d69 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">12</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">13</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d70 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">14</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">15</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d71 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">16</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator </span></span><br><span class="line"> <span class="number">17</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d72 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">18</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">19</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d73 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">20</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d126 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">21</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d74 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">22</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d64 &#125;; //Load the character 1 into the accumulator</span></span><br><span class="line"> <span class="number">23</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d72 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">24</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">25</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d65 &#125;; //Load the character 2 into the accumulator</span></span><br><span class="line"> <span class="number">26</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d73 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">27</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">28</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d66 &#125;; //Load the character 3 into the accumulator</span></span><br><span class="line"> <span class="number">29</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d74 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">30</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">31</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d67 &#125;; //Load the character 4 into the accumulator</span></span><br><span class="line"> <span class="number">32</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d72 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">33</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">34</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d68 &#125;; //Load the character 5 into the accumulator</span></span><br><span class="line"> <span class="number">35</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d73 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">36</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">37</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d69 &#125;; //Load the character 6 into the accumulator</span></span><br><span class="line"> <span class="number">38</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d74 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">39</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">40</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d70 &#125;; //Load the character 7 into the accumulator</span></span><br><span class="line"> <span class="number">41</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d72 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">42</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">43</span>: mdr = &#123;<span class="meta">`LOAD, 7&#x27;d71 &#125;; //Load the character 8 into the accumulator</span></span><br><span class="line"> <span class="number">44</span>: mdr = &#123;<span class="meta">`XOR, 7&#x27;d73 &#125;; //XOR accumulator with key</span></span><br><span class="line"> <span class="number">45</span>: mdr = &#123;<span class="meta">`STORE, 7&#x27;d127 &#125;; //Output to display</span></span><br><span class="line"> <span class="number">46</span>: mdr = &#123;<span class="meta">`BNE, 7&#x27;d55 &#125;; //Loop until all keys are tried</span></span><br><span class="line"> <span class="number">53</span>: mdr = <span class="number">1</span>;</span><br><span class="line"> <span class="number">54</span>: mdr = <span class="number">8</span>;</span><br><span class="line"> <span class="number">55</span>: mdr = <span class="number">22</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*RAM:</span></span><br><span class="line"><span class="comment">64: encrypted character 1</span></span><br><span class="line"><span class="comment">65: encrypted character 2</span></span><br><span class="line"><span class="comment">66: encrypted character 3</span></span><br><span class="line"><span class="comment">67: encrypted character 4</span></span><br><span class="line"><span class="comment">68: encrypted character 5</span></span><br><span class="line"><span class="comment">69: encrypted character 6</span></span><br><span class="line"><span class="comment">70: encrypted character 7</span></span><br><span class="line"><span class="comment">71: encrypted character 8</span></span><br><span class="line"><span class="comment">72: key 1</span></span><br><span class="line"><span class="comment">73: key 2</span></span><br><span class="line"><span class="comment">74: key 3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"> <span class="keyword">endcase</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>To brute force a key length of three it would have to try 32768 possible combinations of keys. However, if the length of the key is unknown it becomes exponentially harder to brute force the attack.</p>
<p>This method is scalable with different key lengths but can still be decrypted as long as the length of the key is less than the length of the encrypted string.</p>
<h4 id="Github-Repository-https-github-com-sunbanett40-XOR-Decryptor"><a href="#Github-Repository-https-github-com-sunbanett40-XOR-Decryptor" class="headerlink" title="Github Repository: https://github.com/sunbanett40/XOR-Decryptor"></a>Github Repository: <a target="_blank" rel="noopener" href="https://github.com/sunbanett40/XOR-Decryptor">https://github.com/sunbanett40/XOR-Decryptor</a></h4>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2021/01/24/SystemVerilog-Microprocessor-Part-1-Building-the-Microprocessor/">SystemVerilog Microprocessor Part 1 - Building the Microprocessor</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2021-01-24T15:02:00.000Z" itemprop="datePublished">
    2021-01-24
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/Microcontroller/">Microcontroller</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Assembler/">Assembler</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/State-Machines/">State Machines</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/SystemVerilog-HDL/">SystemVerilog HDL</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <h3 id="Microprocessor-Architecture"><a href="#Microprocessor-Architecture" class="headerlink" title="Microprocessor Architecture"></a>Microprocessor Architecture</h3><p style="text-align:center;"><img src="/images/sv-microprocessor/IMG_20210123_152930.jpg" alt="CPU Architecture" style="width: 50%; height: 50%">

</p><p>PC:<br>The program counter is a sequential logic module that records the position of the program through the ROM and outputs the position to the sysbus when the next instruction needs to be loaded.</p>
<p>IR:<br>The instruction register is a sequential logic module that reads the opcode from the sysbus and passes it to the sequencer.</p>
<p>Sequencer:<br>The sequencer is a state machine that controls the order of operation for the other modules. This is important to stop any bus contention occurring.</p>
<p style="text-align:center;"><img src="/images/sv-microprocessor/IMG_20210123_151328.jpg" alt="Sequencer ASM Chart" style="width: 50%; height: 50%">

</p><h3 id="Memory-Mapped-Input-and-Output"><a href="#Memory-Mapped-Input-and-Output" class="headerlink" title="Memory Mapped Input and Output"></a>Memory Mapped Input and Output</h3><p>A buffer and a register were now instantiated so that these could be used as input and output to the Microcontroller</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//instantiate 1 register and 1 buffer here</span></span><br><span class="line">buffer <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) b1 (.*)</span>;</span><br><span class="line">sequencer <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) s1 (.*)</span>;</span><br><span class="line">ir <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) i1 (.*)</span>;</span><br><span class="line">pc <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) p1 (.*)</span>;</span><br><span class="line">alu <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) a1 (.*)</span>;</span><br><span class="line">ram <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) r1 (.*)</span>;</span><br><span class="line">rom <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) r2 (.*)</span>;</span><br><span class="line">register <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) r3 (.*)</span>;</span><br></pre></td></tr></table></figure>

<p>The memory, going from address 0 to address 31, should now be connected to these applications.</p>
<p style="text-align:center;"><img src="/images/sv-microprocessor/Memory.png" alt="Memory addresses" style="width: 50%; height: 50%">

</p><p>However, if the CPU attempts to read from address 30, both the buffer and the RAM will be enabled. This is a problem as both RAM and the buffer will assert their values onto the sysbus as they are both being read. The two values on the same bus will interfere with each other giving a signal that is likely neither of them. This is bus contention.</p>
<p>Modifying this line so that mdr is not written to the bus when mar contains addresses 30 or 31.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The following line in the ram module copies the contents of mdr to sysbus:</span></span><br><span class="line"><span class="keyword">assign</span> sysbus = (MDR_bus &amp; mar[WORD_W-OP_W-<span class="number">1</span>]</span><br><span class="line"> &amp; ~(mar==<span class="number">30</span> | mar==<span class="number">31</span>)) ? mdr : &#x27;z ; </span><br></pre></td></tr></table></figure>

<p>Modifying the testbench, I made switches and displays as variables</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> testcpu;</span><br><span class="line"><span class="keyword">parameter</span> <span class="keyword">int</span> WORD_W = <span class="number">8</span>, OP_W = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">logic</span> clock, n_reset;</span><br><span class="line"><span class="keyword">logic</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] switches;</span><br><span class="line"><span class="keyword">logic</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] display;</span><br><span class="line"><span class="keyword">wire</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] sysbus;</span><br></pre></td></tr></table></figure>

<p>Simulating my testbench and microprocessor in Modelsim I got this output for my variables.<br><img src="/images/sv-microprocessor/waveform1.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<p>Both the display register and the switches are of unknown value as they are not defined at any point in the testbench or the program.</p>
<p>I modified the program in the rom module such that the result in the accumulator is STOREd to address 31 (display) as well as address 16.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cpu2 <span class="variable">#(.WORD_W(WORD_W), .OP_W(OP_W)) c1 (.*)</span>;</span><br><span class="line"> <span class="number">0</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">1</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"> <span class="number">2</span>: mdr = &#123;<span class="meta">`ADD, 5&#x27;d6 &#125;; //Add the contents of address to the accumulator</span></span><br><span class="line"> <span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">4</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d31 &#125;; //Store the contents of accumulator</span></span><br><span class="line"> <span class="number">5</span>: mdr = &#123;<span class="meta">`BNE, 5&#x27;d7 &#125;; //Branch if result of last arithmetic operation is not zero</span></span><br><span class="line"> <span class="number">6</span>: mdr = <span class="number">2</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"> <span class="number">7</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br></pre></td></tr></table></figure>

<p>My modified program would output the value to the display register. This clearly shows the<br>program counts up in twos.</p>
<img src="/images/sv-microprocessor/waveform2.png" alt="Modelsim output" style="width: 100%; height: 100%">

<p>I then made a second change to the program in the rom module such that the data for the ADD operation comes from address 30 – the switches. In addition I also modified “testcpu” to apply different values to the switches during the simulation. </p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">1</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">2</span>: mdr = &#123;<span class="meta">`ADD, 5&#x27;d30 &#125;; //Add the contents of address to the accumulator</span></span><br><span class="line"><span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">4</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d31 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">5</span>: mdr = &#123;<span class="meta">`BNE, 5&#x27;d6 &#125;; //Branch if result of last arithmetic operation is not zero</span></span><br><span class="line"><span class="number">6</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br></pre></td></tr></table></figure>

<p>My new program would take the values from the switches and add it to the current value, outputting it to the display register.<br><img src="/images/sv-microprocessor/waveform3.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<h3 id="Extending-the-Microprocessor"><a href="#Extending-the-Microprocessor" class="headerlink" title="Extending the Microprocessor"></a>Extending the Microprocessor</h3><p>Creating a new version of the CPU, cpu3, I added the bitwise xor and bitwise not (complement) functions to act on the accumulator. This meant defining the opcodes, adding new enable lines between the ALU and sequencer, adding the functionality to the ALU and Sequencer and writing a new program in ROM to use these commands.</p>
<p>ALU: </p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (load_ACC)</span><br><span class="line"><span class="keyword">if</span> (ALU_ACC)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span> (ALU_add)</span><br><span class="line">acc &lt;= acc + sysbus;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ALU_sub)</span><br><span class="line">acc &lt;= acc - sysbus;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ALU_xor)</span><br><span class="line">acc &lt;= acc ^ sysbus;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (ALU_comp)</span><br><span class="line">acc &lt;= ~acc;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>Sequencer:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">acc &lt;= sysbus;</span><br><span class="line">s8: <span class="keyword">begin</span></span><br><span class="line">MDR_bus = <span class="number">1&#x27;b1</span> ;</span><br><span class="line">ALU_ACC = <span class="number">1&#x27;b1</span> ;</span><br><span class="line">load_ACC = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">if</span> (op == <span class="meta">`ADD)</span></span><br><span class="line">ALU_add = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="meta">`SUB)</span></span><br><span class="line">ALU_sub = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="meta">`XOR)</span></span><br><span class="line">ALU_xor = <span class="number">1&#x27;b1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="meta">`COMP)</span></span><br><span class="line">ALU_comp = <span class="number">1&#x27;b1</span> ;</span><br><span class="line">Next_State = s0;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>CPU:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> cpu1 <span class="variable">#( parameter WORD_W = 8, OP_W = 3)</span></span><br><span class="line"> ( <span class="keyword">input</span> <span class="keyword">logic</span> clock, n_reset,</span><br><span class="line"> <span class="keyword">inout</span> <span class="keyword">wire</span> [WORD_W-<span class="number">1</span>:<span class="number">0</span>] sysbus);</span><br><span class="line"><span class="keyword">logic</span> ACC_bus, load_ACC, PC_bus, load_PC, load_IR, load_MAR,</span><br><span class="line">MDR_bus, load_MDR, ALU_ACC, ALU_add, ALU_sub, ALU_xor, ALU_comp,</span><br><span class="line">INC_PC, Addr_bus, CS, R_NW, z_flag; </span><br></pre></td></tr></table></figure>

<p>ROM:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> (mar)</span><br><span class="line"><span class="number">0</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">1</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">2</span>: mdr = &#123;<span class="meta">`COMP, 5&#x27;d8 &#125;; //Complement the contents of the accumulator</span></span><br><span class="line"><span class="number">3</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">4</span>: mdr = &#123;<span class="meta">`LOAD, 5&#x27;d16 &#125;; //Load the contents of address into the accumulator</span></span><br><span class="line"><span class="number">5</span>: mdr = &#123;<span class="meta">`XOR, 5&#x27;d9 &#125;; //Xor the contents of address with the accumulator</span></span><br><span class="line"><span class="number">6</span>: mdr = &#123;<span class="meta">`STORE, 5&#x27;d16 &#125;; //Store the contents of accumulator</span></span><br><span class="line"><span class="number">7</span>: mdr = &#123;<span class="meta">`BNE, 5&#x27;d10 &#125;; //Branch if result of last arithmetic operation is not zero</span></span><br><span class="line"><span class="number">8</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"><span class="number">9</span>: mdr = <span class="number">170</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"><span class="number">10</span>: mdr = <span class="number">1</span>; <span class="comment">//contents used by another instruction</span></span><br><span class="line"><span class="keyword">default</span> : mdr = <span class="number">0</span>; <span class="comment">//rest of ROM is 0</span></span><br><span class="line"><span class="keyword">endcase</span></span><br></pre></td></tr></table></figure>

<p>I then verified that the program was working correctly by simulating it in modelsim and going through each operation. I found that by the end of the first cycle the value in ram was 1’h55, which was to be expected when 1’hFF and 1’hAA are XORed together.<br><img src="/images/sv-microprocessor/waveform4.png" alt="Modelsim output" style="width: 100%; height: 100%"></p>
<h4 id="Github-Repository-https-github-com-sunbanett40-XOR-Decryptor"><a href="#Github-Repository-https-github-com-sunbanett40-XOR-Decryptor" class="headerlink" title="Github Repository: https://github.com/sunbanett40/XOR-Decryptor"></a>Github Repository: <a target="_blank" rel="noopener" href="https://github.com/sunbanett40/XOR-Decryptor">https://github.com/sunbanett40/XOR-Decryptor</a></h4>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2019/10/24/Fizzbuzz-on-Arduino/">Fizzbuzz on Arduino</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2019-10-24T11:56:00.000Z" itemprop="datePublished">
    2019-10-24
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/Electronics/">Electronics</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Arduino/">Arduino</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/C-Programming/">C++ Programming</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Microcontroller/">Microcontroller</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Inspired by Tom Scott’s YouTube Video on the <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=QPZ0pIK_wsc&list=PL5ZXG50fTM7oZBZmFhJygA2419Hsg6v8H">FizzBuzz interview question</a> for programmers, which was proposed by the <a target="_blank" rel="noopener" href="https://imranontech.com/2007/01/24/using-fizzbuzz-to-find-developers-who-grok-coding/">‘Imran on Tech’ blog</a>. For this project, I used the Arduino IDE again, using an Arduino Nano and a 10 segment LED display as a physical solution to Imran’s interview question. The project helped to consolidate my programme planning and Arduino coding skills that I learned during my EPQ.</p>
<h3 id="The-Hardware"><a href="#The-Hardware" class="headerlink" title="The Hardware"></a>The Hardware</h3><p>As I was planning on using an Arduino for my solution to the Fizzbuzz game I needed to create a circuit to surport it. As an input it had a button, and a low pass filter for debouncing, connected to a digital pin. As an output it had an LED display connected to digital pins in parrallel. The powerrails were poweered from the power and ground pins.</p>
<p style="text-align:center;"><img src="/images/fizzbuzz/Fizzbuzz2.jpg" alt="Arduino board" style="width: 33%; height: 33%">

</p><h3 id="The-Program"><a href="#The-Program" class="headerlink" title="The Program"></a>The Program</h3><p>In the main loop my program would constantly poll the input pin. Once the button had been pressed it would then increase the count, and loop back to 0 if it reached 100. Then the output would check if the count was a multiple of fizz or buzz and then output the flag. If it was neither then the value would be outputted as a 7 bit binary number. I decided to output it as flags and binary as these would be the most useful way to interact with larger systems if required.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;                                  <span class="comment">//Defining Variables</span></span><br><span class="line"><span class="keyword">int</span> buttonState = <span class="number">0</span>;                            <span class="comment">//Defining buttonState as low</span></span><br><span class="line"><span class="keyword">int</span> ouMin = <span class="number">3</span>, ouMax = <span class="number">12</span>;                      <span class="comment">//Lowest &amp; highest output pin</span></span><br><span class="line"><span class="keyword">int</span> fizz_val = <span class="number">3</span>, buzz_val = <span class="number">5</span>;                 <span class="comment">//Defining values for fizz &amp; buzz</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Buzz = <span class="number">11</span>, Fizz = <span class="number">12</span>, buttonPin = <span class="number">13</span>; <span class="comment">//Setting i/o pins</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">    pinMode(buttonPin, INPUT);           <span class="comment">//Set button as input</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ouMin; i &lt;= ouMax; i++) <span class="comment">//Setting output pins</span></span><br><span class="line">    &#123;</span><br><span class="line">        pinMode(i, OUTPUT);</span><br><span class="line">    &#125;</span><br><span class="line">    Serial.begin(<span class="number">9600</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">    buttonState = digitalRead(buttonPin); <span class="comment">//Read the state of the button value</span></span><br><span class="line">    <span class="keyword">if</span> (buttonState == HIGH)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//Check if the button is pressed</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = ouMin; i &lt;= ouMax; i++) <span class="comment">//If so reset all output pins to 0</span></span><br><span class="line">        &#123;</span><br><span class="line">            digitalWrite(i, LOW);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//increment count</span></span><br><span class="line">        count++;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Reset count when it exceeds 100</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">100</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Check if value is a multiple of fizz</span></span><br><span class="line">    <span class="keyword">if</span> (count % fizz_val == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        digitalWrite(Fizz, HIGH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Check if value is a multiple of buzz</span></span><br><span class="line">    <span class="keyword">if</span> (count % buzz_val == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        digitalWrite(Buzz, HIGH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//check if it is neither a multiple of fizz or buzz</span></span><br><span class="line">    <span class="keyword">if</span> (!((count % fizz_val == <span class="number">0</span>) || (count % buzz_val == <span class="number">0</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> out = count; <span class="comment">//Set local out equal to global count</span></span><br><span class="line">        <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//convert to binary</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">6</span>; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (out &gt;= <span class="built_in">pow</span>(<span class="number">2</span>, j))</span><br><span class="line">            &#123;</span><br><span class="line">                digitalWrite(j + <span class="number">3</span>, HIGH);</span><br><span class="line">                out -= <span class="built_in">pow</span>(<span class="number">2</span>, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    delay(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h3><p>Overall I was pleased with the results of this project, the program worked and the hardware was enough to be able to interpret what was happening. </p>
<p>If I were to improve the hardware I would use multiplexed seven segment displays so the output could be more easily understand. If I were to improve the program I would improve the scalability of the code so that it could be used for a larger set of values.</p>
<p style="text-align:center;"><video style="width: 33%; height: 33%" autoplay muted>
  <source src="/images/fizzbuzz/Fizzbuzz.mp4" type="video/mp4">
This browser does not support the video tag.
</video></p>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2019/06/13/Lottery-Number-Generator-PIC16F88/">Lottery Number Generator - PIC16F88</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2019-06-13T01:07:00.000Z" itemprop="datePublished">
    2019-06-13
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/Electronics/">Electronics</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Microcontroller/">Microcontroller</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Assembler/">Assembler</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <h3 id="Design-Brief"><a href="#Design-Brief" class="headerlink" title="Design Brief"></a>Design Brief</h3><p>The lottery is a part of weekly life in the UK, for many. Adults will often buy tickets hoping to win the jackpot, or simply for the fun of playing. As every number is just as likely as each other, unless you play with lucky pick numbers or personal numbers in mind, it can be hard to choose your numbers. Especially if you wish to use different numbers every week. This product shall generate numbers for the UK lottery, to pick the numbers for people.</p>
<h3 id="Specification"><a href="#Specification" class="headerlink" title="Specification"></a>Specification</h3><p>⦁    It must run off of a 5V supply.<br>⦁    It must have a button when pressed and released generates a number.<br>⦁    The random numbers generated must be between 1 and 59.<br>⦁    Must display in alphanumeric decimal.<br>⦁    It should display 2 digits.<br>⦁    It must output a desired number 98% of the time.<br>⦁    It must generate and display the numbers in under 5 milliseconds.</p>
<h3 id="Inputs-amp-Outputs"><a href="#Inputs-amp-Outputs" class="headerlink" title="Inputs &amp; Outputs"></a>Inputs &amp; Outputs</h3><p>Schmitt NOT Gate (40106B)<br>Pin    Connection    Pin    Connection<br>1        VDD    Connect High<br>2        13<br>3        12<br>4        11<br>5    Connection from PTM switch    10<br>6    Connection to PIC Input    9<br>GND    Connect Low    8    </p>
<p>PIC16F88<br>Pin    Code    Connection    Pin    Code    Connection<br>1    A2        18    A1<br>2    A3        17    A0    Input (from Schmitt Inverter)<br>3    A4        16    A7<br>4    A5        15    A6<br>5    GND    Connect Low    14    VDD    Connect High<br>6    B0    Units BCD A    13    B7<br>7    B1    Units BCD A    12    B6<br>8    B2    Units BCD A    11    B5<br>9    B3    Units BCD B    10    B4    </p>
<p>BCD Decoder Driver (4511B)<br>Pin    Connection    Pin    Connection<br>1    BCD B    VDD    Connect High<br>2    BCD C    15    Segment F<br>3    Connect Low (lamp test)    14    Segment G<br>4    Connect High (ripple blanking)    13    Segment A<br>5    Connect Low (enable/store input)    12    Segment B<br>6    BCD D    11    Segment C<br>7    BCD A    10    Segment D<br>GND    Connect Low    9    Segment E</p>
<h3 id="Circuit-Diagram"><a href="#Circuit-Diagram" class="headerlink" title="Circuit Diagram"></a>Circuit Diagram</h3><h3 id="Flow-Chart"><a href="#Flow-Chart" class="headerlink" title="Flow Chart"></a>Flow Chart</h3><h3 id="Program"><a href="#Program" class="headerlink" title="Program"></a>Program</h3><p>A copy of program version “0700t” &amp; “0700u” attached to the post. When initially coding my project I ran into the problem of it not correctly compiling, upon inspecting my code I found all my instances of “MOVLW” to be “MOVW” this is not a recognised bit of code as it as is not specify a target byte to move to the working register. I remedied this problem by using Notepad++’s find and replace function to correct every instance of this problem.</p>
<p>Another change I made whilst writing my code was to the display section. When I first wrote it I used “BTFSC” and “BSF” commands to transfer the information from the clock register to PORTB. I then found out you can write to PORTB in the same way as any other directory. This allowed me to simplify a section of clumsy and repetitive code to a simpler and  much more elegant solution.  My new code used “MOVF” and “MOVWF” to simply transfer the data in the clock register to the output register of PORTB.</p>
<h3 id="Evidence-of-Building"><a href="#Evidence-of-Building" class="headerlink" title="Evidence of Building"></a>Evidence of Building</h3><p>I started the building of my circuit by placing all the parts that I thought would go over the trench, this allows me to set up an efficient placement for wiring, this is particularly evident in that the “units” BCD decoder driver is underneath the the dual seven segment display so that output C directly lines up with its pin on the display. </p>
<p>I then proceeded to wire the chips, inputs and outputs together. All the wires connecting to positive and negative pins with red and black wire respectively. I used green wire for all the data on the breadboard. I started with the switches to the PIC, then the PIC to the BCD decoder drivers, and finally the BCD decoder drivers to the dual seven segment display.</p>
<p>Whilst testing the circuit I added a Schmitt NOT gate, this is why it is not connected particularly neatly. I used the Schmitt NOT gate to debounce the button input  to the PIC, this was done in an attempt to fix one of the bugs found. Although it was unsuccessful at fixing the bug I kept it in the circuit as I feel it will help the stability of my program.</p>
<h3 id="Evidence-of-Testing"><a href="#Evidence-of-Testing" class="headerlink" title="Evidence of Testing"></a>Evidence of Testing</h3><p>I first tested my program to make sure that the code was working as desired. I did this by using the integrated testing systems on the PIC loading board. By using the buttons and LEDs I could see if any incorrect BCD signals were being sent. I did not find any numbers on either chips that were outside the desired range.</p>
<p>To make sure that the lottery number generator worked I connected the breadboards to 5V and 0V. This showed that it was working as intended. After testing a few random numbers I concluded that there was an error in the wiring of the display. After looking back over the pinout information I found and corrected the error. This meant that all the device was working as intended.</p>
<h3 id="Photo-of-Working-circuit"><a href="#Photo-of-Working-circuit" class="headerlink" title="Photo of Working circuit"></a>Photo of Working circuit</h3><p>Finally I neatened the connections on the board, making everything sit flush on breadboard whilst making sure it all stays working. This makes circuit easier to follow and reduces any stray capacitance in the circuit.</p>
<p>⦁    Testing against specification<br>⦁    It must run off of a 5V supply.<br>⦁    Both the testing board and the final circuit ran off of a 5V supply. I specifically chose 4511s as my BCD decoder driver as they are designed to run off of 5V. The only change I made was adding a capacitor over the power rails as this smoothed any fluctuations in the supply voltage, this was needed as the PIC was especially finicky with its input voltages.<br>⦁    It must have a button when pressed and released generates a number.<br>⦁    The sole input for the device is a button, this needs to be pressed and released for a new number to be generated. This feature was especially coded into my project. Once the button had been pressed the PIC would be stuck in a looping of code until it was released again.</p>
<p>⦁    The random numbers generated must be between 1 and 59.<br>⦁    The numbers generated are between the values 0 and 59. This includes every number that it is supposed to have but has a very small chance of displaying zero. I have literally met the needs of the specification. However, I feel that it is implicit that it doesn’t want any numbers but these, so I am not particularly happy about this<br>⦁    Must display in alphanumeric decimal.<br>⦁    I have used two BCD decoder drivers and a dual seven segment display to turn the output of the output to the PIC into a way that can easily be understood visually.<br>⦁    It should display 2 digits.<br>⦁    By using a dual seven segment display I have limited myself into only being able to display 2 digits, meeting the specification.<br>⦁    It must output a desired number 98% of the time.<br>⦁    To test to see if it was generating a desired number a sufficient amount of the time, I used my generator 200 times and recorded the frequency of every number generated. The number 0 was generated twice giving it a 1% chance of being generated. I see no significant evidence to say that 0 has a different probability of being generated. Giving it a 1.7% chance. This means it generates a desired number 98.3% of the time, meeting the specification.<br>⦁    It must generate and display the numbers in under 5 milliseconds.<br>⦁    The clock speed of the PIC16F88 is 38 KHz. Between the button being released and the clock moving to the output register there is a maximum of 7 lines of code. This means the maximum delay is 0.74 ms, well below the specified 5 ms.</p>
<h3 id="Evaluation"><a href="#Evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h3><p>During this project, I have learnt a great deal about assembly code and microcontrollers in general. This has been a particularly interesting project as I have had no prior experience with these systems, and would be interested to see what I can do with them in the future. If I were to do another project with them I would try using a larger number of Inputs as I feel that processing this information would play to the advantage of micro-controlled systems more than conventional circuits.</p>
<p>I have noticed that my generator also generates the number 00 as well as 01-59. It is my belief that this error is to do with the code. I feel that with an alternative approach to the code that this problem can be remedied. This is likely to need a complete overhaul of the code, but I would say that this is definitely worth it. This would improve the percentage of desired outputs drastically, this would more wholefully meet the specification.</p>
<p>To improve the design of this project, I would reduce the number of PICs to one. This would make a much more efficient design as it is much less wasteful. This would likely make removing 00 as an output easier as it would mean that the two PICs would not have to communicate. If this was made as a commercial project this would drastically reduce the overall cost of the circuit, as PICs are expensive. </p>
<p>Overall I would say that this circuit was effective as it met every part of the specification. However, I would also call it inefficient as it was wasteful in its resources and the end result was underwhelming. Although I am pleased that I underwent this project I am not displeased with the result. I feel that I may have started this over ambitious and I have definitely learnt a lesson in setting realistic goals.</p>

      
    </div>
</article>

    </li>
  
</ul>



            <footer>
    <div>© 2021 - Joseph Butterworth </div>
    <div>
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a target="_blank" rel="noopener" href="https://github.com/nameoverflow/hexo-theme-icalm">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>